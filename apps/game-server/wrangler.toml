name = "game-server-dev"
main = "src/server.ts"
compatibility_date = "2026-02-25"
compatibility_flags = ["nodejs_compat"]

# Migrations for DO state (required for new DO classes)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["GameServer"]

[observability]
enabled = true

[observability.logs]
invocation_logs = true
head_sampling_rate = 1

# ── Staging ──────────────────────────────────────────────
[env.staging]
name = "game-server-staging"
workers_dev = true

[env.staging.observability]
enabled = true

[env.staging.observability.logs]
invocation_logs = true
head_sampling_rate = 1
destinations = ["axiom-logs-staging"]

[[env.staging.routes]]
pattern = "staging-api.peckingorder.ca"
custom_domain = true

[[env.staging.durable_objects.bindings]]
name = "GameServer"
class_name = "GameServer"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "pecking-order-journal-db-staging"
database_id = "660e4807-b2ea-4d1c-b412-91877fbcbf81"

[env.staging.vars]
AXIOM_DATASET = "pecking-order-staging"
VAPID_PUBLIC_KEY = "BCGjVUVQUKz31CzbSrBGfJgAl98xXfS9sY4XfVK7MiIvCWBA5oUmwe_dBWMf_MXCOrs6WW9PPL59pHYG8vYV5ac"
GAME_CLIENT_HOST = "https://staging-play.peckingorder.ca"

# ── Production ───────────────────────────────────────────
[env.production]
name = "game-server"
workers_dev = true

[env.production.observability]
enabled = true

[env.production.observability.logs]
invocation_logs = true
head_sampling_rate = 1
destinations = ["axiom-logs-production"]

[[env.production.routes]]
pattern = "api.peckingorder.ca"
custom_domain = true

[[env.production.durable_objects.bindings]]
name = "GameServer"
class_name = "GameServer"

[[env.production.d1_databases]]
binding = "DB"
database_name = "pecking-order-journal-db"
database_id = "c5941589-2d69-4ae1-9b5d-0554f2ad9721"

[env.production.vars]
AXIOM_DATASET = "pecking-order"
VAPID_PUBLIC_KEY = "BDCbn388daKAMq3g1PyJ5nqfi3btLvsjIFllFkwN4S_hgoXwLBWI0JYY9XMTXhXyX-fEqPDfZKoP0EJ9hNM1OzQ"
GAME_CLIENT_HOST = "https://play.peckingorder.ca"
